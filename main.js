var ee=Object.defineProperty;var ve=Object.getOwnPropertyDescriptor;var Ce=Object.getOwnPropertyNames;var Se=Object.prototype.hasOwnProperty;var De=(c,t)=>{for(var e in t)ee(c,e,{get:t[e],enumerable:!0})},xe=(c,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Ce(t))!Se.call(c,n)&&n!==e&&ee(c,n,{get:()=>t[n],enumerable:!(i=ve(t,n))||i.enumerable});return c};var be=c=>xe(ee({},"__esModule",{value:!0}),c);var Re={};De(Re,{default:()=>J});module.exports=be(Re);var h=require("obsidian");var b=class c{constructor(t){this.value=Math.max(0,Math.min(1,t))}static calculate(t){let{similarity:e,domainDistance:i,isAlreadyLinked:n,genericTermsCount:s}=t,r=e*.4+i*.6,o=n?.5:1,a=Math.max(.3,1-s*.15),l=r*o*a;return new c(l)}static fromValue(t){return new c(t)}isHighSerendipity(){return this.value>=.7}isMediumSerendipity(){return this.value>=.4&&this.value<.7}isLowSerendipity(){return this.value<.4}getLevel(){return this.isHighSerendipity()?"high":this.isMediumSerendipity()?"medium":"low"}toPercent(){return Math.round(this.value*100)}toString(){return`${this.toPercent()}%`}};var w=class c{constructor(t){this.value=Math.max(0,Math.min(1,t))}static calculate(t,e,i){if(t===e)return new c(0);if(i){let n=i.get(t),s=i.get(e);if(n&&s&&n===s)return new c(.5)}return new c(1)}static fromTagJaccard(t,e){if(t.length===0&&e.length===0)return new c(1);let i=new Set(t),n=new Set(e),s=0;for(let a of i)n.has(a)&&s++;let r=i.size+n.size-s;if(r===0)return new c(1);let o=s/r;return new c(1-o)}static fromFolderPath(t,e){let i=t.split("/").filter(Boolean),n=e.split("/").filter(Boolean),s=0,r=Math.min(i.length,n.length);for(let l=0;l<r&&i[l]===n[l];l++)s++;let o=Math.max(i.length,n.length);if(o===0)return new c(1);let a=s/o;return new c(1-a)}static fromValue(t){return new c(t)}isFarDomain(){return this.value>=.7}isMediumDomain(){return this.value>=.3&&this.value<.7}isNearDomain(){return this.value<.3}toString(){return this.value.toFixed(2)}};var E={ai:{provider:"openai",apiKeys:{},model:"gpt-4o-mini"},discovery:{minSimilarity:.5,minSerendipityScore:.4,maxResults:10,excludeFolders:["templates","attachments","09_Embedded"],includeFolders:["04_Zettelkasten"],deepMaxPairs:30,deepMinQuality:.5},advanced:{classificationMethod:"tag",domainTagPrefixes:["domain/","topic/"],debugMode:!1}},te={claude:[{id:"claude-opus-4-5-20251101",name:"Claude Opus 4.5",description:"Highest quality"},{id:"claude-sonnet-4-5-20250514",name:"Claude Sonnet 4.5",description:"Balanced"},{id:"claude-3-5-haiku-20241022",name:"Claude 3.5 Haiku",description:"Fast"}],openai:[{id:"gpt-5.2",name:"GPT-5.2",description:"Latest flagship (Reasoning)"},{id:"gpt-4o",name:"GPT-4o",description:"High quality"},{id:"gpt-4o-mini",name:"GPT-4o Mini",description:"Fast & economical"},{id:"o3-mini",name:"O3 Mini",description:"Reasoning model"}],gemini:[{id:"gemini-3-flash-preview",name:"Gemini 3 Flash",description:"Fast"},{id:"gemini-3-pro-preview",name:"Gemini 3 Pro",description:"Highest quality"},{id:"gemini-2.0-flash",name:"Gemini 2.0 Flash",description:"Stable"}],grok:[{id:"grok-4-1-fast",name:"Grok 4.1 Fast",description:"xAI latest"}]};function we(c){var i,n,s,r;let t=(n=(i=c.serendipityScore)==null?void 0:i.value)!=null?n:0,e=(r=(s=c.domainDistance)==null?void 0:s.value)!=null?r:0;return{sourceNote:c.sourceNote,targetNote:c.targetNote,serendipityScore:b.fromValue(t),domainDistance:w.fromValue(e),similarity:c.similarity,connectionType:c.connectionType,analogy:c.analogy,discoveredAt:new Date(c.discoveredAt)}}function ae(c){return{connections:(c.connections||[]).map(we),timestamp:c.timestamp}}function ce(c){return{...E,...c,ai:{...E.ai,...c.ai},discovery:{...E.discovery,...c.discovery},advanced:{...E.advanced,...c.advanced}}}var g=require("obsidian");function k(c){return{unexpected_similarity:"\uC608\uC0C1\uCE58 \uBABB\uD55C \uC720\uC0AC\uC131",bridging_concept:"\uC5F0\uACB0 \uAC1C\uB150",analogical:"\uC720\uCD94\uC801 \uC5F0\uACB0",contrasting:"\uB300\uC870\uC801 \uAD00\uC810"}[c]}function le(c,t){return c>.8&&t>.8?"unexpected_similarity":c>.6&&t>.5?"bridging_concept":c<.5&&t>.7?"contrasting":"analogical"}function Ee(c){let t=0;for(let e=0;e<c.length;e++){let i=c.charCodeAt(e);t=(t<<5)-t+i,t=t&t}return Math.abs(t).toString(16).padStart(8,"0")}function U(c){let t=c.replace(/\.md$/,"");return Ee(t)}function de(c){return c.replace(/[^a-zA-Z0-9-_]/g,"_")}var p=require("obsidian");var _=class extends p.Modal{constructor(e,i,n,s){super(e);this.plugin=i;this.discoverUseCase=n;this.analogyUseCase=s;this.resultsContainer=null;this.currentMode="standard";this.modeToggleContainer=null}getFileSafe(e){let i=(0,p.normalizePath)(e),n=this.app.vault.getAbstractFileByPath(i);return n instanceof p.TFile?n:this.app.vault.getMarkdownFiles().find(r=>r.path===i)||null}async onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("cdc-serendipity-modal"),e.createEl("h2",{text:"Serendipity Mode"}),e.createEl("p",{text:"Discover the most serendipitous connections across your entire vault.",cls:"cdc-description"}),this.renderModeToggle(),await this.loadMode(this.currentMode)}renderModeToggle(){this.modeToggleContainer&&this.modeToggleContainer.remove(),this.modeToggleContainer=this.contentEl.createDiv({cls:"cdc-mode-toggle"});let e=this.modeToggleContainer.createEl("button",{text:"Standard",cls:`cdc-mode-btn ${this.currentMode==="standard"?"cdc-mode-active":""}`});e.onclick=()=>this.switchMode("standard");let i=this.modeToggleContainer.createEl("button",{text:"Deep (LLM)",cls:`cdc-mode-btn ${this.currentMode==="deep"?"cdc-mode-active":""}`}),n=this.plugin.getDeepSerendipityUseCase();n||(i.addClass("cdc-mode-disabled"),i.title="AI API key required for Deep Mode"),i.onclick=async()=>{if(!n){new p.Notice("Deep Mode requires AI API key configuration");return}await this.switchMode("deep")};let s=this.modeToggleContainer.createDiv({cls:"cdc-mode-description"});this.currentMode==="standard"?s.setText("Embedding similarity-based discovery"):s.setText("LLM evaluates creative connections between distant domains")}async switchMode(e){this.currentMode!==e&&(this.currentMode=e,this.renderModeToggle(),this.resultsContainer&&(this.resultsContainer.remove(),this.resultsContainer=null),await this.loadMode(e))}async loadMode(e){e==="standard"?await this.loadStandardMode():await this.loadDeepMode()}async loadStandardMode(){let e=await this.plugin.getSerendipityCache();e&&e.connections.length>0?this.showStandardSelectionUI(e):await this.performStandardSearch()}async loadDeepMode(){let e=await this.plugin.getDeepSerendipityCache();e&&e.connections.length>0?this.showDeepSelectionUI(e):await this.performDeepSearch()}showStandardSelectionUI(e){let{contentEl:i}=this,n=i.createDiv({cls:"cdc-selection-container"}),s=new Date(e.timestamp),r=this.getTimeAgo(s);n.createEl("p",{text:`Previous results found (${e.connections.length} connections, ${r})`,cls:"cdc-cache-info"});let o=n.createDiv({cls:"cdc-selection-buttons"}),a=o.createEl("button",{text:"Load Previous Results",cls:"cdc-btn cdc-btn-primary"});a.onclick=()=>{n.remove(),this.renderStandardConnections(e.connections),new p.Notice(`Loaded ${e.connections.length} cached connections`)};let l=o.createEl("button",{text:"New Search",cls:"cdc-btn cdc-btn-secondary"});l.onclick=async()=>{n.remove(),await this.performStandardSearch()};let d=o.createEl("button",{text:"Clear Cache",cls:"cdc-btn cdc-btn-small"});d.onclick=async()=>{await this.plugin.clearSerendipityCache(),n.remove(),await this.performStandardSearch(),new p.Notice("Cache cleared")}}showDeepSelectionUI(e){let{contentEl:i}=this,n=i.createDiv({cls:"cdc-selection-container"}),s=new Date(e.timestamp),r=this.getTimeAgo(s);n.createEl("p",{text:`Previous Deep results found (${e.connections.length} connections, ${r})`,cls:"cdc-cache-info"});let o=n.createDiv({cls:"cdc-selection-buttons"}),a=o.createEl("button",{text:"Load Previous Results",cls:"cdc-btn cdc-btn-primary"});a.onclick=()=>{n.remove(),this.renderDeepConnections(e.connections),new p.Notice(`Loaded ${e.connections.length} deep connections`)};let l=o.createEl("button",{text:"New Deep Search",cls:"cdc-btn cdc-btn-secondary"});l.onclick=async()=>{n.remove(),await this.performDeepSearch()};let d=o.createEl("button",{text:"Clear Cache",cls:"cdc-btn cdc-btn-small"});d.onclick=async()=>{await this.plugin.clearDeepSerendipityCache(),n.remove(),await this.performDeepSearch(),new p.Notice("Deep cache cleared")}}async performStandardSearch(){let{contentEl:e}=this,i=e.createEl("p",{text:"Analyzing vault... This may take a moment.",cls:"cdc-loading"});try{let n=await this.discoverUseCase.findTopSerendipitousConnections(10);if(i.remove(),n.length===0){e.createEl("p",{text:"No serendipitous connections found. Make sure you have embeddings generated.",cls:"cdc-no-results"});return}await this.plugin.setSerendipityCache({connections:n,timestamp:Date.now()}),e.createEl("p",{text:`Found ${n.length} serendipitous connections:`,cls:"cdc-result-count"}),this.renderStandardConnections(n),new p.Notice(`Found ${n.length} connections (saved to cache)`)}catch(n){console.error("[CDC] Standard serendipity mode error:",n),i.remove(),e.createEl("p",{text:"Failed to analyze vault. Check console for details.",cls:"cdc-error"})}}async performDeepSearch(){let{contentEl:e}=this,i=this.plugin.getDeepSerendipityUseCase();if(!i){e.createEl("p",{text:"Deep Mode requires AI API key configuration.",cls:"cdc-error"});return}let n=e.createEl("p",{text:"Deep analyzing vault with LLM... This may take several minutes.",cls:"cdc-loading"}),s=e.createEl("p",{text:"Sampling cross-domain pairs and evaluating with LLM...",cls:"cdc-progress"});try{let r=await i.execute();if(n.remove(),s.remove(),r.length===0){e.createEl("p",{text:"No deep connections found. Try adjusting settings or ensure you have diverse domains in your vault.",cls:"cdc-no-results"});return}let o=r.map(a=>({sourceNote:{noteId:a.sourceNote.noteId,path:a.sourceNote.path,title:a.sourceNote.title,primaryDomain:a.sourceNote.primaryDomain,tags:a.sourceNote.tags},targetNote:{noteId:a.targetNote.noteId,path:a.targetNote.path,title:a.targetNote.title,primaryDomain:a.targetNote.primaryDomain,tags:a.targetNote.tags},creativityScore:a.creativityScore,analogy:a.analogy,domainDistance:a.domainDistance,discoveredAt:a.discoveredAt.toISOString()}));await this.plugin.setDeepSerendipityCache({connections:o,timestamp:Date.now()}),e.createEl("p",{text:`Found ${r.length} deep creative connections:`,cls:"cdc-result-count"}),this.renderDeepConnections(o),new p.Notice(`Found ${r.length} deep connections (saved to cache)`)}catch(r){console.error("[CDC] Deep serendipity mode error:",r),n.remove(),s.remove(),e.createEl("p",{text:"Failed to perform deep analysis. Check console for details.",cls:"cdc-error"})}}renderStandardConnections(e){this.resultsContainer&&this.resultsContainer.remove(),this.resultsContainer=this.contentEl.createDiv({cls:"cdc-serendipity-list"}),e.forEach((i,n)=>{let s=this.resultsContainer.createDiv({cls:"cdc-serendipity-item"});s.createEl("span",{text:`#${n+1}`,cls:"cdc-rank"});let r=s.createDiv({cls:"cdc-serendipity-info"}),o=r.createDiv({cls:"cdc-titles"});o.createEl("strong",{text:i.sourceNote.title}),o.createEl("span",{text:" \u2194 ",cls:"cdc-arrow"}),o.createEl("strong",{text:i.targetNote.title}),r.createEl("span",{text:` (${i.serendipityScore.toString()})`,cls:`cdc-score cdc-score-${i.serendipityScore.getLevel()}`}),r.createEl("p",{text:`${i.sourceNote.primaryDomain} \u2192 ${i.targetNote.primaryDomain}`,cls:"cdc-domain-path"}),r.createEl("span",{text:k(i.connectionType),cls:"cdc-connection-type"});let a=s.createDiv({cls:"cdc-item-actions"}),l=a.createEl("button",{text:"Open Source",cls:"cdc-btn cdc-btn-small"});l.onclick=()=>{this.app.workspace.openLinkText(i.sourceNote.path,"",!1)};let d=a.createEl("button",{text:"Open Target",cls:"cdc-btn cdc-btn-small"});if(d.onclick=()=>{this.app.workspace.openLinkText(i.targetNote.path,"",!1)},this.analogyUseCase&&!i.analogy){let m=a.createEl("button",{text:"Analogy",cls:"cdc-btn cdc-btn-small cdc-btn-secondary"});m.onclick=async()=>{m.disabled=!0,m.textContent="...";try{let y=await this.analogyUseCase.execute(i);i.analogy=y,r.createEl("p",{text:y,cls:"cdc-analogy"}),m.remove(),new p.Notice("Analogy generated"),this.addCreateLinkButton(a,i)}catch(y){m.textContent="Fail",m.disabled=!1}}}i.analogy&&(r.createEl("p",{text:i.analogy,cls:"cdc-analogy"}),this.addCreateLinkButton(a,i))})}renderDeepConnections(e){this.resultsContainer&&this.resultsContainer.remove(),this.resultsContainer=this.contentEl.createDiv({cls:"cdc-serendipity-list cdc-deep-list"}),e.forEach((i,n)=>{let s=this.resultsContainer.createDiv({cls:"cdc-serendipity-item cdc-deep-item"}),r=s.createDiv({cls:"cdc-rank-badge"});r.createEl("span",{text:`#${n+1}`,cls:"cdc-rank"}),r.createEl("span",{text:`\u2728 ${(i.creativityScore*100).toFixed(0)}%`,cls:"cdc-creativity-score"});let o=s.createDiv({cls:"cdc-serendipity-info"}),a=o.createDiv({cls:"cdc-titles"});a.createEl("strong",{text:i.sourceNote.title}),a.createEl("span",{text:" \u2194 ",cls:"cdc-arrow"}),a.createEl("strong",{text:i.targetNote.title});let l=o.createDiv({cls:"cdc-domain-info"});l.createEl("span",{text:`${i.sourceNote.primaryDomain}`,cls:"cdc-domain-badge"}),l.createEl("span",{text:" \u27F7 ",cls:"cdc-domain-arrow"}),l.createEl("span",{text:`${i.targetNote.primaryDomain}`,cls:"cdc-domain-badge"}),i.analogy&&i.analogy!=="\uC5F0\uACB0 \uC5C6\uC74C"&&o.createEl("p",{text:`\u{1F4A1} ${i.analogy}`,cls:"cdc-analogy cdc-deep-analogy"});let d=s.createDiv({cls:"cdc-item-actions"}),m=d.createEl("button",{text:"Open Source",cls:"cdc-btn cdc-btn-small"});m.onclick=()=>{this.app.workspace.openLinkText(i.sourceNote.path,"",!1)};let y=d.createEl("button",{text:"Open Target",cls:"cdc-btn cdc-btn-small"});y.onclick=()=>{this.app.workspace.openLinkText(i.targetNote.path,"",!1)},i.analogy&&i.analogy!=="\uC5F0\uACB0 \uC5C6\uC74C"&&this.addDeepCreateLinkButton(d,i)})}addCreateLinkButton(e,i){if(!i.analogy)return;let n=e.createEl("button",{text:"Create Link",cls:"cdc-btn cdc-btn-small cdc-btn-primary"});n.onclick=async()=>{n.disabled=!0,n.textContent="...";try{let s=this.plugin.getLinkCreationService(),r=this.getFileSafe(i.sourceNote.path);if(!r){new p.Notice("\uC18C\uC2A4 \uB178\uD2B8\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4."),n.textContent="Create Link",n.disabled=!1;return}let o=this.getFileSafe(i.targetNote.path);if(!o){new p.Notice("\uD0C0\uAC9F \uB178\uD2B8\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4."),n.textContent="Create Link",n.disabled=!1;return}let a=await s.addBidirectionalLink(r,o,i.analogy);a.success?(new p.Notice(a.message),n.textContent="\u2713 Linked",n.disabled=!0,n.addClass("cdc-btn-success")):(new p.Notice(a.message),n.textContent="Create Link",n.disabled=!1)}catch(s){console.error("[CDC] Link creation failed:",s),new p.Notice("\uC5F0\uACB0 \uC0DD\uC131\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4."),n.textContent="Create Link",n.disabled=!1}}}addDeepCreateLinkButton(e,i){let n=e.createEl("button",{text:"Create Link",cls:"cdc-btn cdc-btn-small cdc-btn-primary"});n.onclick=async()=>{n.disabled=!0,n.textContent="...";try{let s=this.plugin.getLinkCreationService(),r=this.getFileSafe(i.sourceNote.path);if(!r){new p.Notice("\uC18C\uC2A4 \uB178\uD2B8\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4."),n.textContent="Create Link",n.disabled=!1;return}let o=this.getFileSafe(i.targetNote.path);if(!o){new p.Notice("\uD0C0\uAC9F \uB178\uD2B8\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4."),n.textContent="Create Link",n.disabled=!1;return}let a=await s.addBidirectionalLink(r,o,i.analogy);a.success?(new p.Notice(a.message),n.textContent="\u2713 Linked",n.disabled=!0,n.addClass("cdc-btn-success")):(new p.Notice(a.message),n.textContent="Create Link",n.disabled=!1)}catch(s){console.error("[CDC] Deep link creation failed:",s),new p.Notice("\uC5F0\uACB0 \uC0DD\uC131\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4."),n.textContent="Create Link",n.disabled=!1}}}getTimeAgo(e){let n=new Date().getTime()-e.getTime(),s=Math.floor(n/6e4),r=Math.floor(n/36e5),o=Math.floor(n/864e5);return s<1?"just now":s<60?`${s} min ago`:r<24?`${r} hour${r>1?"s":""} ago`:o<7?`${o} day${o>1?"s":""} ago`:e.toLocaleDateString()}onClose(){this.contentEl.empty(),this.resultsContainer=null,this.modeToggleContainer=null}};var T="cross-domain-connector-view",V=class extends g.ItemView{constructor(e,i,n,s){super(e);this.plugin=i;this.discoverUseCase=n;this.analogyUseCase=s;this.resultsContainer=null;this.statusEl=null}getViewType(){return T}getDisplayText(){return"Cross-Domain Connector"}getIcon(){return"git-branch"}getFileSafe(e){let i=(0,g.normalizePath)(e),n=this.app.vault.getAbstractFileByPath(i);return n instanceof g.TFile?n:this.app.vault.getMarkdownFiles().find(r=>r.path===i)||null}async onOpen(){let e=this.containerEl.children[1];e.empty(),e.addClass("cdc-container"),e.createDiv({cls:"cdc-header"}).createEl("h4",{text:"Cross-Domain Connector"});let n=e.createDiv({cls:"cdc-button-container"}),s=n.createEl("button",{text:"Discover Connections",cls:"cdc-btn cdc-btn-primary"});s.onclick=()=>this.discoverConnections();let r=n.createEl("button",{text:"Serendipity Mode",cls:"cdc-btn cdc-btn-secondary"});r.onclick=()=>this.openSerendipityMode(),this.statusEl=e.createDiv({cls:"cdc-status"}),this.statusEl.setText('Select a note and click "Discover Connections"'),this.resultsContainer=e.createDiv({cls:"cdc-results"})}async onClose(){this.resultsContainer=null,this.statusEl=null}async discoverConnections(){let e=this.app.workspace.getActiveFile();if(!e){new g.Notice("No active note selected");return}this.statusEl&&this.statusEl.setText("Discovering connections...");try{let i=U(e.path),n=await this.discoverUseCase.execute(i);this.renderConnections(n,e.basename),n.length===0?new g.Notice("No cross-domain connections found"):new g.Notice(`Found ${n.length} connections`)}catch(i){console.error("[CDC] Error discovering connections:",i),new g.Notice("Failed to discover connections"),this.statusEl&&this.statusEl.setText("Error: Failed to discover connections")}}renderConnections(e,i){if(this.resultsContainer){if(this.resultsContainer.empty(),this.statusEl&&this.statusEl.setText(e.length>0?`Found ${e.length} connections from "${i}"`:"No connections found"),e.length===0){this.resultsContainer.createEl("p",{text:"No cross-domain connections found for this note.",cls:"cdc-no-results"});return}e.forEach(n=>{let s=this.resultsContainer.createDiv({cls:"cdc-connection-card"}),r=s.createDiv({cls:"cdc-card-header"}),o=r.createEl("span",{text:n.serendipityScore.toString(),cls:`cdc-score cdc-score-${n.serendipityScore.getLevel()}`});r.createEl("h5",{text:n.targetNote.title,cls:"cdc-card-title"}),s.createEl("p",{text:`${n.sourceNote.primaryDomain} \u2192 ${n.targetNote.primaryDomain}`,cls:"cdc-domain-path"}),s.createEl("span",{text:k(n.connectionType),cls:"cdc-connection-type"}),s.createEl("p",{text:`Similarity: ${(n.similarity*100).toFixed(1)}%`,cls:"cdc-similarity"});let a=s.createDiv({cls:"cdc-card-actions"});if(this.analogyUseCase&&!n.analogy){let d=a.createEl("button",{text:"Generate Analogy",cls:"cdc-btn cdc-btn-small"});d.onclick=async()=>{d.disabled=!0,d.textContent="Generating...";try{let m=await this.analogyUseCase.execute(n);n.analogy=m,s.createEl("p",{text:m,cls:"cdc-analogy"}),d.remove(),this.addCreateLinkButton(a,n)}catch(m){console.error("[CDC] Analogy generation failed:",m),d.textContent="Failed",d.disabled=!1}}}n.analogy&&this.addCreateLinkButton(a,n);let l=a.createEl("button",{text:"Open Note",cls:"cdc-btn cdc-btn-small cdc-btn-secondary"});l.onclick=()=>{this.app.workspace.openLinkText(n.targetNote.path,"",!1)}})}}addCreateLinkButton(e,i){if(!i.analogy)return;let n=e.createEl("button",{text:"Create Link",cls:"cdc-btn cdc-btn-small cdc-btn-primary"});n.onclick=async()=>{n.disabled=!0,n.textContent="...";try{let s=this.plugin.getLinkCreationService(),r=this.getFileSafe(i.sourceNote.path);if(!r){new g.Notice("\uC18C\uC2A4 \uB178\uD2B8\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4."),n.textContent="Create Link",n.disabled=!1;return}let o=this.getFileSafe(i.targetNote.path);if(!o){new g.Notice("\uD0C0\uAC9F \uB178\uD2B8\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4."),n.textContent="Create Link",n.disabled=!1;return}let a=await s.addBidirectionalLink(r,o,i.analogy);a.success?(new g.Notice(a.message),n.textContent="\u2713 Linked",n.disabled=!0,n.addClass("cdc-btn-success")):(new g.Notice(a.message),n.textContent="Create Link",n.disabled=!1)}catch(s){console.error("[CDC] Link creation failed:",s),new g.Notice("\uC5F0\uACB0 \uC0DD\uC131\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4."),n.textContent="Create Link",n.disabled=!1}}}async openSerendipityMode(){new _(this.app,this.plugin,this.discoverUseCase,this.analogyUseCase).open()}};var ue=require("obsidian");var S=require("obsidian");var me=require("obsidian"),C=class{constructor(t,e){this.apiKey=t;this.modelId=e}async httpRequest(t,e,i){return(await(0,me.requestUrl)({url:t,method:"POST",headers:{"Content-Type":"application/json",...e},body:JSON.stringify(i)})).json}normalizeError(t){if(console.error("[CDC] API Error:",t),t instanceof Error){let e=t.message;return e.includes("429")||e.includes("rate")?{message:"API \uC694\uCCAD \uD55C\uB3C4 \uCD08\uACFC. \uC7A0\uC2DC \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.",code:"RATE_LIMIT"}:e.includes("401")||e.includes("403")?{message:"API \uD0A4\uAC00 \uC720\uD6A8\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4. \uC124\uC815\uC5D0\uC11C \uD655\uC778\uD574\uC8FC\uC138\uC694.",code:"AUTH_ERROR"}:e.includes("timeout")||e.includes("ETIMEDOUT")?{message:"\uC694\uCCAD \uC2DC\uAC04\uC774 \uCD08\uACFC\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uB124\uD2B8\uC6CC\uD06C\uB97C \uD655\uC778\uD574\uC8FC\uC138\uC694.",code:"TIMEOUT"}:e.includes("404")||e.includes("model")?{message:"\uC120\uD0DD\uD55C \uBAA8\uB378\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",code:"MODEL_NOT_FOUND"}:{message:e,code:"UNKNOWN"}}return{message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4.",code:"UNKNOWN"}}};var ke="https://api.anthropic.com/v1/messages",Pe="2023-06-01",A=class extends C{async generate(t){var e;if(!this.apiKey)return{success:!1,error:{message:"Claude API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.",code:"NO_API_KEY"}};try{let{systemPrompt:i,messages:n}=this.convertMessages(t.messages),s={model:this.modelId,messages:n,max_tokens:(e=t.maxTokens)!=null?e:4096};i&&(s.system=i),t.temperature!==void 0&&(s.temperature=t.temperature);let r=await this.httpRequest(ke,{"x-api-key":this.apiKey,"anthropic-version":Pe},s);if(r.content&&r.content.length>0){let o=r.content.find(a=>a.type==="text");if(o)return{success:!0,content:o.text}}return r.error?{success:!1,error:{message:r.error.message,code:"API_ERROR"}}:{success:!1,error:{message:"\uC751\uB2F5\uC744 \uD30C\uC2F1\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",code:"PARSE_ERROR"}}}catch(i){return{success:!1,error:this.normalizeError(i)}}}convertMessages(t){let e=null,i=[];for(let n of t)n.role==="system"?e=n.content:i.push({role:n.role,content:n.content});return{systemPrompt:e,messages:i}}};var Te={"claude-opus-4-5-20251101":{id:"claude-opus-4-5-20251101",displayName:"Claude Opus 4.5",provider:"claude",maxTokens:32768,contextWindow:2e5,isReasoning:!1},"claude-sonnet-4-5-20250514":{id:"claude-sonnet-4-5-20250514",displayName:"Claude Sonnet 4.5",provider:"claude",maxTokens:16384,contextWindow:2e5,isReasoning:!1},"claude-3-5-haiku-20241022":{id:"claude-3-5-haiku-20241022",displayName:"Claude 3.5 Haiku",provider:"claude",maxTokens:8192,contextWindow:2e5,isReasoning:!1},"gpt-4o":{id:"gpt-4o",displayName:"GPT-4o",provider:"openai",maxTokens:16384,contextWindow:128e3,isReasoning:!1},"gpt-4o-mini":{id:"gpt-4o-mini",displayName:"GPT-4o Mini",provider:"openai",maxTokens:16384,contextWindow:128e3,isReasoning:!1},"gpt-5.2":{id:"gpt-5.2",displayName:"GPT-5.2",provider:"openai",maxTokens:32768,contextWindow:4e5,isReasoning:!0},"gpt-5.2-codex":{id:"gpt-5.2-codex",displayName:"GPT-5.2 Codex",provider:"openai",maxTokens:32768,contextWindow:4e5,isReasoning:!0},"o3-mini":{id:"o3-mini",displayName:"O3 Mini",provider:"openai",maxTokens:65536,contextWindow:128e3,isReasoning:!0},o1:{id:"o1",displayName:"O1",provider:"openai",maxTokens:65536,contextWindow:128e3,isReasoning:!0},"o1-mini":{id:"o1-mini",displayName:"O1 Mini",provider:"openai",maxTokens:65536,contextWindow:128e3,isReasoning:!0},"gemini-3-flash-preview":{id:"gemini-3-flash-preview",displayName:"Gemini 3 Flash",provider:"gemini",maxTokens:8192,contextWindow:1e6,isReasoning:!1},"gemini-3-pro-preview":{id:"gemini-3-pro-preview",displayName:"Gemini 3 Pro",provider:"gemini",maxTokens:8192,contextWindow:2e6,isReasoning:!1},"gemini-2.0-flash":{id:"gemini-2.0-flash",displayName:"Gemini 2.0 Flash",provider:"gemini",maxTokens:8192,contextWindow:1e6,isReasoning:!1},"grok-4-1-fast":{id:"grok-4-1-fast",displayName:"Grok 4.1 Fast",provider:"grok",maxTokens:16384,contextWindow:131072,isReasoning:!1}};function N(c){var t,e;return(e=(t=Te[c])==null?void 0:t.isReasoning)!=null?e:!1}var Ae="https://api.openai.com/v1/chat/completions",I=class extends C{async generate(t){var e,i;if(!this.apiKey)return{success:!1,error:{message:"OpenAI API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.",code:"NO_API_KEY"}};try{let n=N(this.modelId),s={model:this.modelId,messages:t.messages.map(o=>({role:o.role,content:o.content}))};n?s.max_completion_tokens=(e=t.maxTokens)!=null?e:4096:(s.max_tokens=(i=t.maxTokens)!=null?i:4096,t.temperature!==void 0&&(s.temperature=t.temperature));let r=await this.httpRequest(Ae,{Authorization:`Bearer ${this.apiKey}`},s);return r.choices&&r.choices.length>0?{success:!0,content:r.choices[0].message.content}:r.error?{success:!1,error:{message:r.error.message,code:"API_ERROR"}}:{success:!1,error:{message:"\uC751\uB2F5\uC744 \uD30C\uC2F1\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",code:"PARSE_ERROR"}}}catch(n){return{success:!1,error:this.normalizeError(n)}}}};var Ne="https://generativelanguage.googleapis.com/v1beta/models",R=class extends C{async generate(t){var e;if(!this.apiKey)return{success:!1,error:{message:"Gemini API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.",code:"NO_API_KEY"}};try{let i=`${Ne}/${this.modelId}:generateContent?key=${this.apiKey}`,s={contents:this.convertMessages(t.messages),generationConfig:{maxOutputTokens:(e=t.maxTokens)!=null?e:4096}};t.temperature!==void 0&&(s.generationConfig.temperature=t.temperature);let r=await this.httpRequest(i,{},s);if(r.candidates&&r.candidates.length>0){let o=r.candidates[0].content.parts;if(o&&o.length>0)return{success:!0,content:o.map(a=>a.text).join("")}}return r.error?{success:!1,error:{message:r.error.message,code:"API_ERROR"}}:{success:!1,error:{message:"\uC751\uB2F5\uC744 \uD30C\uC2F1\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",code:"PARSE_ERROR"}}}catch(i){return{success:!1,error:this.normalizeError(i)}}}convertMessages(t){let e=[],i="";for(let n of t)if(n.role==="system")i=n.content;else if(n.role==="user"){let s=i?`${i}

${n.content}`:n.content;e.push({role:"user",parts:[{text:s}]}),i=""}else n.role==="assistant"&&e.push({role:"model",parts:[{text:n.content}]});return e}};var Ie="https://api.x.ai/v1/chat/completions",L=class extends C{async generate(t){var e;if(!this.apiKey)return{success:!1,error:{message:"Grok API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.",code:"NO_API_KEY"}};try{let i={model:this.modelId,messages:t.messages.map(s=>({role:s.role,content:s.content})),max_tokens:(e=t.maxTokens)!=null?e:4096};t.temperature!==void 0&&(i.temperature=t.temperature);let n=await this.httpRequest(Ie,{Authorization:`Bearer ${this.apiKey}`},i);return n.choices&&n.choices.length>0?{success:!0,content:n.choices[0].message.content}:n.error?{success:!1,error:{message:n.error.message,code:"API_ERROR"}}:{success:!1,error:{message:"\uC751\uB2F5\uC744 \uD30C\uC2F1\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",code:"PARSE_ERROR"}}}catch(i){return{success:!1,error:this.normalizeError(i)}}}};var M=null;function ne(c){return M=new ie(c),M}function pe(c){M&&M.updateSettings(c)}function se(){M=null}var ie=class{constructor(t){this.settings=t,this.provider=this.createProvider()}updateSettings(t){this.settings=t,this.provider=this.createProvider()}createProvider(){let t=this.settings.apiKeys[this.settings.provider]||"";switch(this.settings.provider){case"claude":return new A(t,this.settings.model);case"openai":return new I(t,this.settings.model);case"gemini":return new R(t,this.settings.model);case"grok":return new L(t,this.settings.model);default:throw new Error(`Unknown provider: ${this.settings.provider}`)}}async simpleGenerate(t,e){let i=N(this.settings.model);return this.provider.generate({messages:[...e?[{role:"system",content:e}]:[],{role:"user",content:t}],temperature:i?void 0:.7,maxTokens:4096})}async generate(t,e){var s,r;let n=N(this.settings.model)?void 0:(s=e==null?void 0:e.temperature)!=null?s:.7;return this.provider.generate({messages:[...e!=null&&e.systemPrompt?[{role:"system",content:e.systemPrompt}]:[],{role:"user",content:t}],temperature:n,maxTokens:(r=e==null?void 0:e.maxTokens)!=null?r:4096})}getCurrentProvider(){return this.settings.provider}getCurrentModel(){return this.settings.model}hasApiKey(){return!!this.settings.apiKeys[this.settings.provider]}async testApiKey(){try{return await this.provider.generate({messages:[{role:"user",content:"Hello"}],maxTokens:10})}catch(t){return{success:!1,error:{message:t instanceof Error?t.message:"Unknown error",code:"TEST_FAILED"}}}}};async function ge(c,t,e){if(!t)return{success:!1,error:{message:"API key is empty",code:"EMPTY_KEY"}};let i;try{switch(c){case"claude":i=new A(t,e);break;case"openai":i=new I(t,e);break;case"gemini":i=new R(t,e);break;case"grok":i=new L(t,e);break;default:throw new Error(`Unknown provider: ${c}`)}return await i.generate({messages:[{role:"user",content:'Say "OK" if you can read this.'}],maxTokens:10})}catch(n){return{success:!1,error:{message:n instanceof Error?n.message:"Unknown error",code:"TEST_FAILED"}}}}var K=class{constructor(t,e){this.containerEl=t;this.plugin=e}render(){this.containerEl.createEl("h3",{text:"AI Settings"}),new S.Setting(this.containerEl).setName("AI Provider").setDesc("Select the AI provider for analogy generation").addDropdown(s=>{s.addOption("claude","Claude (Anthropic)").addOption("openai","OpenAI").addOption("gemini","Gemini (Google)").addOption("grok","Grok (xAI)").setValue(this.plugin.settings.ai.provider).onChange(async r=>{var a;this.plugin.settings.ai.provider=r;let o=te[r];o&&o.length>0&&(this.plugin.settings.ai.model=o[0].id),await this.plugin.saveSettings(),this.containerEl.empty(),(a=this.plugin.settingTab)==null||a.display()})});let t=this.plugin.settings.ai.provider,e=te[t]||[];new S.Setting(this.containerEl).setName("Model").setDesc("Select the AI model").addDropdown(s=>{e.forEach(r=>{s.addOption(r.id,`${r.name}${r.description?` - ${r.description}`:""}`)}),s.setValue(this.plugin.settings.ai.model).onChange(async r=>{this.plugin.settings.ai.model=r,await this.plugin.saveSettings()})});let i=this.getApiKeyDescription(t);new S.Setting(this.containerEl).setName(`${this.getProviderName(t)} API Key`).setDesc(i).addText(s=>{s.setPlaceholder("Enter your API key").setValue(this.plugin.settings.ai.apiKeys[t]||"").onChange(async r=>{this.plugin.settings.ai.apiKeys[t]=r,await this.plugin.saveSettings()}),s.inputEl.type="password"}).addButton(s=>{s.setButtonText("Test").setCta().onClick(async()=>{var o;let r=this.plugin.settings.ai.apiKeys[t];if(!r){new S.Notice("Please enter an API key first");return}s.setButtonText("Testing..."),s.setDisabled(!0);try{let a=await ge(t,r,this.plugin.settings.ai.model);a.success?new S.Notice(`\u2705 API key is valid! (${this.getProviderName(t)})`):new S.Notice(`\u274C API key test failed: ${((o=a.error)==null?void 0:o.message)||"Unknown error"}`)}catch(a){new S.Notice(`\u274C Test failed: ${a instanceof Error?a.message:"Unknown error"}`)}finally{s.setButtonText("Test"),s.setDisabled(!1)}})});let n=this.getApiKeyHelpLink(t);n&&new S.Setting(this.containerEl).setName("Get API Key").setDesc(`Get your ${this.getProviderName(t)} API key`).addButton(s=>{s.setButtonText("Open").onClick(()=>{window.open(n,"_blank")})})}getProviderName(t){return{claude:"Anthropic",openai:"OpenAI",gemini:"Google",grok:"xAI"}[t]}getApiKeyDescription(t){return{claude:"Your Anthropic API key for Claude models",openai:"Your OpenAI API key. Note: Reasoning models (o1, o3, gpt-5.x) do not support temperature.",gemini:"Your Google AI API key for Gemini models",grok:"Your xAI API key for Grok models"}[t]}getApiKeyHelpLink(t){return{claude:"https://console.anthropic.com/settings/keys",openai:"https://platform.openai.com/api-keys",gemini:"https://aistudio.google.com/app/apikey",grok:"https://console.x.ai"}[t]||null}};var P=require("obsidian"),W=class{constructor(t,e){this.containerEl=t;this.plugin=e}render(){this.containerEl.createEl("h3",{text:"Discovery Settings"}),new P.Setting(this.containerEl).setName("Minimum Similarity").setDesc("Minimum embedding similarity threshold (0.0-1.0). Higher values mean stricter matching.").addSlider(t=>{t.setLimits(.3,.9,.05).setValue(this.plugin.settings.discovery.minSimilarity).setDynamicTooltip().onChange(async e=>{this.plugin.settings.discovery.minSimilarity=e,await this.plugin.saveSettings()})}).addExtraButton(t=>{t.setIcon("reset").setTooltip("Reset to default (0.5)").onClick(async()=>{var e;this.plugin.settings.discovery.minSimilarity=.5,await this.plugin.saveSettings(),this.containerEl.empty(),(e=this.plugin.settingTab)==null||e.display()})}),new P.Setting(this.containerEl).setName("Minimum Serendipity Score").setDesc("Minimum serendipity score threshold (0.0-1.0). Higher values show more surprising connections.").addSlider(t=>{t.setLimits(.2,.8,.05).setValue(this.plugin.settings.discovery.minSerendipityScore).setDynamicTooltip().onChange(async e=>{this.plugin.settings.discovery.minSerendipityScore=e,await this.plugin.saveSettings()})}).addExtraButton(t=>{t.setIcon("reset").setTooltip("Reset to default (0.4)").onClick(async()=>{var e;this.plugin.settings.discovery.minSerendipityScore=.4,await this.plugin.saveSettings(),this.containerEl.empty(),(e=this.plugin.settingTab)==null||e.display()})}),new P.Setting(this.containerEl).setName("Maximum Results").setDesc("Maximum number of connections to display").addSlider(t=>{t.setLimits(5,30,1).setValue(this.plugin.settings.discovery.maxResults).setDynamicTooltip().onChange(async e=>{this.plugin.settings.discovery.maxResults=e,await this.plugin.saveSettings()})}),new P.Setting(this.containerEl).setName("Include Folders").setDesc("Only search within these folders (comma-separated). Leave empty to search all.").addTextArea(t=>{t.setPlaceholder("04_Zettelkasten").setValue(this.plugin.settings.discovery.includeFolders.join(", ")).onChange(async e=>{this.plugin.settings.discovery.includeFolders=e.split(",").map(i=>i.trim()).filter(i=>i.length>0),await this.plugin.saveSettings()}),t.inputEl.rows=2}),new P.Setting(this.containerEl).setName("Exclude Folders").setDesc("Folders to exclude from connection discovery (comma-separated)").addTextArea(t=>{t.setPlaceholder("templates, attachments, archive").setValue(this.plugin.settings.discovery.excludeFolders.join(", ")).onChange(async e=>{this.plugin.settings.discovery.excludeFolders=e.split(",").map(i=>i.trim()).filter(i=>i.length>0),await this.plugin.saveSettings()}),t.inputEl.rows=2})}};var D=require("obsidian"),H=class{constructor(t,e){this.containerEl=t;this.plugin=e}render(){this.containerEl.createEl("h3",{text:"Advanced Settings"}),new D.Setting(this.containerEl).setName("Domain Classification Method").setDesc("How to determine the domain of each note").addDropdown(t=>{t.addOption("tag","Tag-based (uses #domain/ or #topic/ tags)").addOption("folder","Folder-based (uses folder structure)").addOption("cluster","Cluster-based (auto-detect from embeddings)").setValue(this.plugin.settings.advanced.classificationMethod).onChange(async e=>{this.plugin.settings.advanced.classificationMethod=e,await this.plugin.saveSettings()})}),new D.Setting(this.containerEl).setName("Domain Tag Prefixes").setDesc("Tag prefixes to use for domain detection (comma-separated)").addText(t=>{t.setPlaceholder("domain/, topic/").setValue(this.plugin.settings.advanced.domainTagPrefixes.join(", ")).onChange(async e=>{this.plugin.settings.advanced.domainTagPrefixes=e.split(",").map(i=>i.trim()).filter(i=>i.length>0),await this.plugin.saveSettings()})}),new D.Setting(this.containerEl).setName("Debug Mode").setDesc("Enable detailed logging in the console").addToggle(t=>{t.setValue(this.plugin.settings.advanced.debugMode).onChange(async e=>{this.plugin.settings.advanced.debugMode=e,await this.plugin.saveSettings()})}),new D.Setting(this.containerEl).setName("Embeddings Source").setDesc("Cross-Domain Connector uses embeddings from the Vault Embeddings plugin (09_Embedded folder)").addButton(t=>{t.setButtonText("Check Embeddings").onClick(async()=>{let e=await this.plugin.getEmbeddingCount();e>0?new D.Notice(`Found ${e} embeddings available`):new D.Notice("No embeddings found. Please run Vault Embeddings plugin first.")})}),new D.Setting(this.containerEl).setName("Reset Settings").setDesc("Reset all settings to default values").addButton(t=>{t.setButtonText("Reset").setWarning().onClick(async()=>{var e;confirm("Are you sure you want to reset all settings to default?")&&(await this.plugin.resetSettings(),this.containerEl.empty(),(e=this.plugin.settingTab)==null||e.display(),new D.Notice("Settings reset to default"))})})}};var z=class extends ue.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Cross-Domain Connector Settings"}),new K(t,this.plugin).render(),new W(t,this.plugin).render(),new H(t,this.plugin).render()}};var j=require("obsidian");function he(c){var t,e;return{noteId:c.noteId,path:c.path,title:c.title,primaryDomain:c.primaryDomain,secondaryDomains:(t=c.secondaryDomains)!=null?t:[],tags:(e=c.tags)!=null?e:[],embedding:c.embedding}}var F=class{constructor(t,e,i){this.vault=t;this.getMetadata=e;this.settings=i;this.noteIdToPath=new Map;this.buildNoteIdIndex()}buildNoteIdIndex(){this.noteIdToPath.clear();let t=this.vault.getMarkdownFiles();for(let e of t){let i=U(e.path);this.noteIdToPath.set(i,e.path)}}refreshIndex(){this.buildNoteIdIndex()}getPathByNoteId(t){return this.noteIdToPath.get(t)}getFileByNoteId(t){let e=this.noteIdToPath.get(t);if(!e)return null;let i=(0,j.normalizePath)(e),n=this.vault.getAbstractFileByPath(i);return n instanceof j.TFile?n:this.vault.getMarkdownFiles().find(r=>r.path===i)||null}async classifyNote(t,e){let i=this.getFileByNoteId(t);if(!i)throw new Error(`Note not found: ${t}`);let n=this.getMetadata(i),s=this.extractTags(n),r;switch(this.settings.method){case"tag":r=this.inferDomainFromTags(s)||this.inferDomainFromPath(i.path);break;case"folder":r=this.inferDomainFromPath(i.path);break;case"cluster":r=`cluster_${t}`;break;default:r="uncategorized"}return he({noteId:t,path:i.path,title:i.basename,primaryDomain:r,secondaryDomains:this.extractSecondaryDomains(s,r),tags:s,embedding:e})}inferDomainFromTags(t){for(let e of this.settings.domainTagPrefixes){let i=t.find(n=>n.startsWith(e));if(i)return i.slice(e.length)}return null}inferDomainFromPath(t){let e=t.split("/");if(e.length>=2){let i=e[0];return/^\d+_/.test(i)&&e.length>=3?e[1]:i}return"root"}extractTags(t){return t!=null&&t.tags?t.tags.map(e=>e.tag.replace(/^#/,"")):[]}extractSecondaryDomains(t,e){let i=[];for(let n of this.settings.domainTagPrefixes){let s=t.filter(r=>r.startsWith(n));for(let r of s){let o=r.slice(n.length);o!==e&&!i.includes(o)&&i.push(o)}}return i}};var ye=["note","idea","concept","thought","\uB178\uD2B8","\uC544\uC774\uB514\uC5B4","\uAC1C\uB150","\uC0DD\uAC01","summary","overview","\uC694\uC57D","\uAC1C\uC694"],$=class{constructor(t,e,i,n){this.vault=t;this.embeddingsReader=e;this.classificationService=i;this.options=n}async execute(t){console.log(`[CDC] === Starting discovery for source: ${t} ===`);let e=await this.embeddingsReader.getEmbedding(t);if(!e)return console.warn(`[CDC] No embedding found for source note: ${t}`),[];console.log(`[CDC] Source embedding loaded, dimensions: ${e.embedding.length}`);let i=await this.classificationService.classifyNote(t,e.embedding);console.log(`[CDC] Source domain: ${i.primaryDomain}, tags: ${i.tags.join(", ")}`);let n=await this.embeddingsReader.getAllEmbeddings();console.log(`[CDC] Total embeddings loaded: ${n.size}`);let s=[],r=0,o=0,a=0,l=0,d=0,m=0,y=0;for(let[u,f]of n){if(u===t){r++;continue}let v=this.classificationService.getPathByNoteId(u);if(v){if(!this.isIncludedPath(v)){o++;continue}if(this.isExcludedPath(v)){o++;continue}}let Z=this.classificationService.getPathByNoteId(t);if(Z&&v&&this.isAlreadyLinked(Z,v)){y++;continue}try{let x=await this.classificationService.classifyNote(u,f.embedding);if(i.primaryDomain===x.primaryDomain){a++;continue}let G=this.cosineSimilarity(e.embedding,f.embedding);if(G<this.options.minSimilarity){l++;continue}let X=w.fromTagJaccard(i.tags,x.tags),oe=b.calculate({similarity:G,domainDistance:X.value,isAlreadyLinked:!1,genericTermsCount:this.countGenericTerms(x)});if(oe.value<this.options.minSerendipityScore){d++;continue}s.push({sourceNote:i,targetNote:x,serendipityScore:oe,domainDistance:X,similarity:G,connectionType:le(G,X.value),discoveredAt:new Date})}catch(x){m++;continue}}return console.log("[CDC] === Discovery Summary ==="),console.log(`[CDC] Skip self: ${r}`),console.log(`[CDC] Skip excluded: ${o}`),console.log(`[CDC] Skip already linked: ${y}`),console.log(`[CDC] Skip same domain: ${a}`),console.log(`[CDC] Skip low similarity: ${l}`),console.log(`[CDC] Skip low serendipity: ${d}`),console.log(`[CDC] Classify errors: ${m}`),console.log(`[CDC] Candidates found: ${s.length}`),s.sort((u,f)=>f.serendipityScore.value-u.serendipityScore.value).slice(0,this.options.maxResults)}async findTopSerendipitousConnections(t=10){let e=[],i=new Set,n=await this.embeddingsReader.getAllEmbeddings(),s=Array.from(n.keys()),r=s.length>100?this.sampleArray(s,100):s;for(let o of r){let a=await this.execute(o);for(let l of a){let d=[l.sourceNote.noteId,l.targetNote.noteId].sort().join("-");i.has(d)||(i.add(d),e.push(l))}}return e.sort((o,a)=>a.serendipityScore.value-o.serendipityScore.value).slice(0,t)}cosineSimilarity(t,e){if(t.length!==e.length)throw new Error("Vectors must have same length");let i=0,n=0,s=0;for(let o=0;o<t.length;o++)i+=t[o]*e[o],n+=t[o]*t[o],s+=e[o]*e[o];let r=Math.sqrt(n)*Math.sqrt(s);return r===0?0:i/r}isAlreadyLinked(t,e){return this.options.linkChecker?this.options.linkChecker(t,e):!1}countGenericTerms(t){let e=t.title.toLowerCase(),i=0;for(let n of ye)e.includes(n.toLowerCase())&&i++;for(let n of t.tags){let s=n.toLowerCase();for(let r of ye)s.includes(r.toLowerCase())&&i++}return i}isIncludedPath(t){if(!this.options.includeFolders||this.options.includeFolders.length===0)return!0;let e=t.toLowerCase();return this.options.includeFolders.some(i=>e.startsWith(i.toLowerCase()+"/"))}isExcludedPath(t){let e=t.toLowerCase();return this.options.excludeFolders.some(i=>e.startsWith(i.toLowerCase()+"/"))}sampleArray(t,e){return[...t].sort(()=>Math.random()-.5).slice(0,e)}};var O=class{constructor(t){this.aiService=t}async execute(t){let e=this.buildPrompt(t),i=this.buildSystemPrompt(),n=await this.aiService.simpleGenerate(e,i);return n.success&&n.content?n.content.trim():this.getFallbackAnalogy(t)}async executeBatch(t){let e=new Map;for(let i of t){let n=`${i.sourceNote.noteId}-${i.targetNote.noteId}`;try{let s=await this.execute(i);e.set(n,s)}catch(s){console.error("[CDC] Analogy generation failed:",s),e.set(n,this.getFallbackAnalogy(i))}}return e}buildPrompt(t){let e=k(t.connectionType);return`\uB450 \uB178\uD2B8 \uAC04\uC758 \uCC3D\uBC1C\uC801 \uC5F0\uACB0\uC744 \uBD84\uC11D\uD558\uACE0 \uC720\uCD94(analogy)\uB97C \uC0DD\uC131\uD574\uC8FC\uC138\uC694.

## \uC18C\uC2A4 \uB178\uD2B8
- \uC81C\uBAA9: ${t.sourceNote.title}
- \uB3C4\uBA54\uC778: ${t.sourceNote.primaryDomain}
- \uD0DC\uADF8: ${t.sourceNote.tags.join(", ")||"\uC5C6\uC74C"}

## \uD0C0\uAC9F \uB178\uD2B8
- \uC81C\uBAA9: ${t.targetNote.title}
- \uB3C4\uBA54\uC778: ${t.targetNote.primaryDomain}
- \uD0DC\uADF8: ${t.targetNote.tags.join(", ")||"\uC5C6\uC74C"}

## \uC5F0\uACB0 \uC815\uBCF4
- \uC720\uC0AC\uB3C4: ${(t.similarity*100).toFixed(1)}%
- \uB3C4\uBA54\uC778 \uAC70\uB9AC: ${t.domainDistance.value.toFixed(2)}
- \uC5F0\uACB0 \uC720\uD615: ${e}
- \uCC3D\uBC1C\uC131 \uC810\uC218: ${t.serendipityScore.toPercent()}%

## \uC694\uCCAD
\uC774 \uB450 \uB178\uD2B8\uAC00 \uC65C \uC5F0\uACB0\uB420 \uC218 \uC788\uB294\uC9C0, \uC5B4\uB5A4 \uAD6C\uC870\uC801/\uAC1C\uB150\uC801 \uC720\uC0AC\uC131\uC774 \uC788\uB294\uC9C0 2-3\uBB38\uC7A5\uC73C\uB85C \uC124\uBA85\uD574\uC8FC\uC138\uC694.
\uAC00\uB2A5\uD558\uB2E4\uBA74 \uB450 \uB3C4\uBA54\uC778\uC744 \uC5F0\uACB0\uD558\uB294 \uD575\uC2EC \uD1B5\uCC30\uC774\uB098 \uC720\uCD94\uB97C \uC81C\uC2DC\uD574\uC8FC\uC138\uC694.`}buildSystemPrompt(){return`\uB2F9\uC2E0\uC740 \uC9C0\uC2DD \uD1B5\uD569 \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4. \uC11C\uB85C \uB2E4\uB978 \uBD84\uC57C\uC758 \uAC1C\uB150\uB4E4 \uC0AC\uC774\uC5D0\uC11C \uC228\uACA8\uC9C4 \uC5F0\uACB0\uACE0\uB9AC\uB97C \uBC1C\uACAC\uD558\uACE0,
\uCC3D\uC758\uC801\uC778 \uC720\uCD94(analogy)\uB97C \uD1B5\uD574 \uC0C8\uB85C\uC6B4 \uD1B5\uCC30\uC744 \uC81C\uC2DC\uD558\uB294 \uC5ED\uD560\uC744 \uD569\uB2C8\uB2E4.

\uC751\uB2F5 \uC2DC \uC8FC\uC758\uC0AC\uD56D:
- \uAC04\uACB0\uD558\uACE0 \uBA85\uD655\uD558\uAC8C 2-3\uBB38\uC7A5\uC73C\uB85C \uB2F5\uBCC0
- \uD53C\uC0C1\uC801\uC778 \uC5F0\uACB0\uC774 \uC544\uB2CC \uAD6C\uC870\uC801/\uAC1C\uB150\uC801 \uC720\uC0AC\uC131\uC5D0 \uC9D1\uC911
- \uB450 \uB3C4\uBA54\uC778 \uBAA8\uB450\uC5D0 \uAD00\uC2EC \uC788\uB294 \uB3C5\uC790\uAC00 \uC774\uD574\uD560 \uC218 \uC788\uB294 \uC5B8\uC5B4 \uC0AC\uC6A9
- \uAC00\uB2A5\uD558\uBA74 \uAD6C\uCCB4\uC801\uC778 \uC608\uC2DC\uB098 \uBE44\uC720 \uD3EC\uD568`}getFallbackAnalogy(t){let e=t.sourceNote.title,i=t.targetNote.title,n=t.sourceNote.primaryDomain,s=t.targetNote.primaryDomain;switch(t.connectionType){case"unexpected_similarity":return`'${e}'(${n})\uACFC '${i}'(${s})\uC740 \uB2E4\uB978 \uBD84\uC57C\uC784\uC5D0\uB3C4 \uB192\uC740 \uAC1C\uB150\uC801 \uC720\uC0AC\uC131\uC744 \uBCF4\uC785\uB2C8\uB2E4.`;case"bridging_concept":return`'${e}'\uC640 '${i}'\uC740 ${n}\uACFC ${s}\uC744 \uC5F0\uACB0\uD558\uB294 \uAD50\uB7C9 \uAC1C\uB150\uC77C \uC218 \uC788\uC2B5\uB2C8\uB2E4.`;case"analogical":return`'${e}'\uC758 \uAD6C\uC870\uAC00 '${i}'\uC5D0\uC11C \uC720\uCD94\uC801\uC73C\uB85C \uC801\uC6A9\uB420 \uC218 \uC788\uC2B5\uB2C8\uB2E4.`;case"contrasting":return`'${e}'\uC640 '${i}'\uC740 \uB300\uC870\uC801 \uAD00\uC810\uC744 \uC81C\uACF5\uD558\uC5EC \uC0C1\uD638 \uC774\uD574\uB97C \uAE4A\uAC8C \uD569\uB2C8\uB2E4.`;default:return`'${e}'\uC640 '${i}' \uC0AC\uC774\uC5D0 \uD765\uBBF8\uB85C\uC6B4 \uC5F0\uACB0\uC774 \uBC1C\uACAC\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`}}};var B=class{constructor(t,e,i,n){this.embeddingsReader=t;this.classificationService=e;this.aiService=i;this.options=n}async execute(){console.log("[CDC Deep] === Starting Deep Serendipity Discovery ===");let t=await this.embeddingsReader.getAllEmbeddings();console.log(`[CDC Deep] Total embeddings: ${t.size}`);let e=await this.groupNotesByDomain(t);console.log(`[CDC Deep] Domains found: ${e.size}`);let i=this.sampleCrossDomainPairs(e);if(console.log(`[CDC Deep] Candidate pairs sampled: ${i.length}`),i.length===0)return console.warn("[CDC Deep] No candidate pairs found"),[];let n=await this.evaluatePairsWithLLM(i);return console.log(`[CDC Deep] Connections with positive evaluation: ${n.length}`),n.filter(s=>s.creativityScore>=this.options.minQualityScore).sort((s,r)=>r.creativityScore-s.creativityScore).slice(0,this.options.maxResults)}async groupNotesByDomain(t){var i;let e=new Map;for(let[n]of t)try{let s=this.classificationService.getPathByNoteId(n);if(!s||!this.isIncludedPath(s)||this.isExcludedPath(s))continue;let r=(i=t.get(n))==null?void 0:i.embedding;if(!r)continue;let o=await this.classificationService.classifyNote(n,r),a=o.primaryDomain;e.has(a)||e.set(a,[]),e.get(a).push(o)}catch(s){continue}return e}sampleCrossDomainPairs(t){let e=[],i=Array.from(t.keys());if(i.length<2)return console.warn("[CDC Deep] Not enough domains for cross-domain discovery"),[];for(let s=0;s<i.length;s++)for(let r=s+1;r<i.length;r++){let o=i[s],a=i[r],l=t.get(o),d=t.get(a),m=1,y=this.sampleArray(l,3),u=this.sampleArray(d,3);for(let f of y)for(let v of u)e.push({source:f,target:v,domainDistance:m})}return e.sort(()=>Math.random()-.5).slice(0,this.options.maxPairsToEvaluate)}async evaluatePairsWithLLM(t){let e=[];for(let i of t)try{let n=await this.evaluateSinglePair(i.source,i.target);n.connectionPossible&&n.qualityScore>0&&e.push({sourceNote:i.source,targetNote:i.target,creativityScore:n.qualityScore,analogy:n.analogy,domainDistance:i.domainDistance,discoveredAt:new Date})}catch(n){console.error("[CDC Deep] LLM evaluation failed:",n)}return e}async evaluateSinglePair(t,e){let i=this.buildEvaluationPrompt(t,e),n=this.buildSystemPrompt(),s=await this.aiService.simpleGenerate(i,n);return!s.success||!s.content?{connectionPossible:!1,qualityScore:0,analogy:""}:this.parseEvaluationResponse(s.content)}buildEvaluationPrompt(t,e){return`\uB2E4\uC74C \uB450 \uB178\uD2B8 \uC0AC\uC774\uC5D0 \uCC3D\uC758\uC801\uC774\uACE0 \uC758\uBBF8 \uC788\uB294 \uC5F0\uACB0\uC774 \uAC00\uB2A5\uD55C\uC9C0 \uD3C9\uAC00\uD574\uC8FC\uC138\uC694.

## \uB178\uD2B8 A
- \uC81C\uBAA9: ${t.title}
- \uB3C4\uBA54\uC778: ${t.primaryDomain}
- \uD0DC\uADF8: ${t.tags.join(", ")||"\uC5C6\uC74C"}

## \uB178\uD2B8 B
- \uC81C\uBAA9: ${e.title}
- \uB3C4\uBA54\uC778: ${e.primaryDomain}
- \uD0DC\uADF8: ${e.tags.join(", ")||"\uC5C6\uC74C"}

## \uD3C9\uAC00 \uAE30\uC900
1. \uD45C\uBA74\uC801\uC73C\uB85C \uAD00\uB828 \uC5C6\uC5B4 \uBCF4\uC774\uC9C0\uB9CC \uAE4A\uC740 \uAD6C\uC870\uC801/\uAC1C\uB150\uC801 \uC720\uC0AC\uC131\uC774 \uC788\uB294\uAC00?
2. \uD55C \uBD84\uC57C\uC758 \uD1B5\uCC30\uC774 \uB2E4\uB978 \uBD84\uC57C\uC5D0 \uC801\uC6A9\uB420 \uC218 \uC788\uB294\uAC00?
3. \uB450 \uAC1C\uB150\uC744 \uC5F0\uACB0\uD558\uBA74 \uC0C8\uB85C\uC6B4 \uC544\uC774\uB514\uC5B4\uAC00 \uB3C4\uCD9C\uB420 \uC218 \uC788\uB294\uAC00?

## \uC751\uB2F5 \uD615\uC2DD (\uBC18\uB4DC\uC2DC \uC774 \uD615\uC2DD\uC744 \uC9C0\uCF1C\uC8FC\uC138\uC694)
CONNECTION_POSSIBLE: [YES/NO]
QUALITY_SCORE: [0.0-1.0 \uC0AC\uC774 \uC22B\uC790, \uC18C\uC218\uC810 \uCCAB\uC9F8 \uC790\uB9AC\uAE4C\uC9C0]
ANALOGY: [2-3\uBB38\uC7A5\uC73C\uB85C \uCC3D\uC758\uC801 \uC5F0\uACB0 \uC124\uBA85. \uC5F0\uACB0\uC774 \uC5C6\uC73C\uBA74 "\uC5F0\uACB0 \uC5C6\uC74C"]

\uC608\uC2DC:
CONNECTION_POSSIBLE: YES
QUALITY_SCORE: 0.8
ANALOGY: \uC9C4\uD654\uB860\uC758 '\uC801\uC790\uC0DD\uC874' \uC6D0\uB9AC\uAC00 \uC2A4\uD0C0\uD2B8\uC5C5 \uC0DD\uD0DC\uACC4\uC5D0\uC11C\uB3C4 \uB3D9\uC77C\uD558\uAC8C \uC791\uB3D9\uD569\uB2C8\uB2E4. \uD658\uACBD\uC5D0 \uC801\uC751\uD558\uC9C0 \uBABB\uD55C \uC885\uC774 \uB3C4\uD0DC\uB418\uB4EF, \uC2DC\uC7A5 \uBCC0\uD654\uC5D0 \uB300\uC751\uD558\uC9C0 \uBABB\uD55C \uAE30\uC5C5\uB3C4 \uC0AC\uB77C\uC9D1\uB2C8\uB2E4.`}buildSystemPrompt(){return`\uB2F9\uC2E0\uC740 \uCC3D\uC758\uC801 \uC5F0\uACB0 \uBC1C\uACAC \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4.
\uC11C\uB85C \uB2E4\uB978 \uBD84\uC57C\uC758 \uAC1C\uB150\uB4E4 \uC0AC\uC774\uC5D0\uC11C \uC228\uACA8\uC9C4 \uAD6C\uC870\uC801 \uC720\uC0AC\uC131\uACFC \uAE4A\uC740 \uD1B5\uCC30\uC744 \uBC1C\uACAC\uD558\uB294 \uC5ED\uD560\uC744 \uD569\uB2C8\uB2E4.

\uC911\uC694:
- \uD53C\uC0C1\uC801\uC778 \uC5F0\uACB0(\uB2E8\uC21C \uD0A4\uC6CC\uB4DC \uC720\uC0AC)\uC740 \uB0AE\uC740 \uC810\uC218\uB97C \uBD80\uC5EC\uD558\uC138\uC694.
- \uC9C4\uC815\uC73C\uB85C \uCC3D\uC758\uC801\uC778 \uC5F0\uACB0(\uAD6C\uC870\uC801 \uC720\uCD94, \uD328\uD134 \uC778\uC2DD, \uB3C4\uBA54\uC778 \uAC04 \uD1B5\uCC30 \uC774\uC804)\uC5D0 \uB192\uC740 \uC810\uC218\uB97C \uBD80\uC5EC\uD558\uC138\uC694.
- \uC5F0\uACB0\uC774 \uC5B5\uC9C0\uC2A4\uB7FD\uAC70\uB098 \uC758\uBBF8\uAC00 \uC5C6\uB2E4\uBA74 CONNECTION_POSSIBLE: NO\uB85C \uB2F5\uD558\uC138\uC694.
- \uBC18\uB4DC\uC2DC \uC9C0\uC815\uB41C \uC751\uB2F5 \uD615\uC2DD\uC744 \uB530\uB974\uC138\uC694.`}parseEvaluationResponse(t){let e=t.split(`
`),i=!1,n=0,s="";for(let r of e){let o=r.trim();if(o.startsWith("CONNECTION_POSSIBLE:"))i=o.includes("YES");else if(o.startsWith("QUALITY_SCORE:")){let a=o.match(/[\d.]+/);a&&(n=Math.min(1,Math.max(0,parseFloat(a[0]))))}else o.startsWith("ANALOGY:")&&(s=o.replace("ANALOGY:","").trim())}if(!s){let r=t.indexOf("ANALOGY:");r!==-1&&(s=t.slice(r+8).trim())}return{connectionPossible:i,qualityScore:n,analogy:s}}sampleArray(t,e){return t.length<=e?[...t]:[...t].sort(()=>Math.random()-.5).slice(0,e)}isIncludedPath(t){if(!this.options.includeFolders||this.options.includeFolders.length===0)return!0;let e=t.toLowerCase();return this.options.includeFolders.some(i=>e.startsWith(i.toLowerCase()+"/"))}isExcludedPath(t){let e=t.toLowerCase();return this.options.excludeFolders.some(i=>e.startsWith(i.toLowerCase()+"/"))}};var Y=require("obsidian");var re="09_Embedded",fe=50,q=class{constructor(t){this.vault=t;this.allEmbeddingsCache=null;this.allEmbeddingsCacheTime=0;this.CACHE_TTL_MS=6e4}async getEmbedding(t){let e=de(t),i=(0,Y.normalizePath)(`${re}/embeddings/${e}.json`);try{if(!this.vault.getAbstractFileByPath(i)&&!await this.vault.adapter.exists(i))return null;let s=await this.vault.adapter.read(i),r=JSON.parse(s);return{noteId:r.noteId||t,embedding:r.vector||r.embedding,model:r.model||"unknown",updatedAt:r.updatedAt||new Date().toISOString()}}catch(n){return console.error(`[CDC] Failed to read embedding for ${t}:`,n),null}}async getAllEmbeddings(){let t=Date.now();if(this.allEmbeddingsCache&&t-this.allEmbeddingsCacheTime<this.CACHE_TTL_MS)return this.allEmbeddingsCache;let e=new Map,i=await this.readIndex();if(!i)return console.warn("[CDC] No embedding index found"),e;let n=Object.keys(i.notes);console.log(`[CDC] Found ${n.length} notes in embedding index`);for(let s=0;s<n.length;s+=fe){let r=n.slice(s,s+fe);(await Promise.all(r.map(a=>this.getEmbedding(a)))).forEach((a,l)=>{a&&e.set(r[l],a)})}return console.log(`[CDC] Loaded ${e.size} embeddings`),this.allEmbeddingsCache=e,this.allEmbeddingsCacheTime=t,e}clearAllCache(){this.allEmbeddingsCache=null,this.allEmbeddingsCacheTime=0}async readIndex(){let t=(0,Y.normalizePath)(`${re}/index.json`);try{if(!this.vault.getAbstractFileByPath(t)&&!await this.vault.adapter.exists(t))return null;let i=await this.vault.adapter.read(t);return JSON.parse(i)}catch(e){return console.error("[CDC] Failed to read embedding index:",e),null}}async hasEmbeddingFolder(){let t=(0,Y.normalizePath)(re);try{return await this.vault.adapter.exists(t)}catch(e){return!1}}async getEmbeddingCount(){let t=await this.readIndex();return t?Object.keys(t.notes).length:0}};var Q=class{constructor(t){this.vault=t}async addLinkToNote(t,e){try{let i=await this.vault.read(t),n="### \u{1F517} \uC5F0\uACB0\uB41C \uB178\uD2B8",s=i.indexOf(n);if(s===-1)return{success:!1,message:'\uB178\uD2B8\uC5D0 "### \u{1F517} \uC5F0\uACB0\uB41C \uB178\uD2B8" \uC139\uC158\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.'};let r=e.reason.replace(/\n+/g," ").trim(),o=`- [[${e.targetTitle}]] \u2022 \uC5F0\uACB0 \uC9C1\uAD00 \u2014 ${r}`;if(i.includes(`[[${e.targetTitle}]]`))return{success:!1,message:`"${e.targetTitle}" \uB9C1\uD06C\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4.`};let a=s+n.length,d=i.substring(a).match(/\n(#{2,3}\s)/),m=d?a+d.index:i.length,u=i.substring(a,m).match(/^- \[\[.+\]\].*$/gm),f;if(u&&u.length>0){let v=u[u.length-1],x=i.lastIndexOf(v,m)+v.length;f=i.substring(0,x)+`
`+o+i.substring(x)}else f=i.substring(0,a)+`

`+o+i.substring(a).replace(/^\n+/,`
`);return await this.vault.modify(t,f),{success:!0,message:`"${e.targetTitle}" \uC5F0\uACB0\uC774 \uCD94\uAC00\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`}}catch(i){return console.error("[CDC] Link creation failed:",i),{success:!1,message:"\uC5F0\uACB0 \uC0DD\uC131\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4."}}}async addBidirectionalLink(t,e,i){let n=await this.addLinkToNote(t,{targetTitle:e.basename,reason:i});if(!n.success)return n;let s=await this.addLinkToNote(e,{targetTitle:t.basename,reason:i});return s.success?{success:!0,message:"\uC591\uBC29\uD5A5 \uC5F0\uACB0\uC774 \uCD94\uAC00\uB418\uC5C8\uC2B5\uB2C8\uB2E4."}:{success:!0,message:`\uC18C\uC2A4 \uB178\uD2B8\uC5D0 \uC5F0\uACB0 \uCD94\uAC00\uB428. \uD0C0\uAC9F \uB178\uD2B8: ${s.message}`}}};var J=class extends h.Plugin{constructor(){super(...arguments);this.settingTab=null;this.aiService=null;this.analogyUseCase=null;this.deepSerendipityUseCase=null}async onload(){console.log("[CDC] Loading Cross-Domain Connector plugin"),await this.loadSettings(),this.embeddingsReader=new q(this.app.vault),this.linkCreationService=new Q(this.app.vault),this.classificationService=new F(this.app.vault,e=>this.app.metadataCache.getFileCache(e),{method:this.settings.advanced.classificationMethod,domainTagPrefixes:this.settings.advanced.domainTagPrefixes}),this.settings.ai.apiKeys[this.settings.ai.provider]&&(this.aiService=ne(this.settings.ai),this.analogyUseCase=new O(this.aiService),this.deepSerendipityUseCase=new B(this.embeddingsReader,this.classificationService,this.aiService,{maxPairsToEvaluate:this.settings.discovery.deepMaxPairs,minQualityScore:this.settings.discovery.deepMinQuality,maxResults:this.settings.discovery.maxResults,includeFolders:this.settings.discovery.includeFolders,excludeFolders:this.settings.discovery.excludeFolders})),this.discoverUseCase=new $(this.app.vault,this.embeddingsReader,this.classificationService,{minSimilarity:this.settings.discovery.minSimilarity,minSerendipityScore:this.settings.discovery.minSerendipityScore,maxResults:this.settings.discovery.maxResults,excludeFolders:this.settings.discovery.excludeFolders,includeFolders:this.settings.discovery.includeFolders,linkChecker:this.createLinkChecker()}),this.registerView(T,e=>new V(e,this,this.discoverUseCase,this.analogyUseCase)),this.addCommand({id:"open-cdc-view",name:"Open Cross-Domain Connector",callback:()=>this.activateView()}),this.addCommand({id:"discover-connections",name:"Discover Cross-Domain Connections for Current Note",checkCallback:e=>this.app.workspace.getActiveFile()?(e||this.activateView(),!0):!1}),this.settingTab=new z(this.app,this),this.addSettingTab(this.settingTab),this.addRibbonIcon("git-branch","Cross-Domain Connector",()=>{this.activateView()}),this.registerEvent(this.app.vault.on("create",()=>{this.classificationService.refreshIndex()})),this.registerEvent(this.app.vault.on("delete",()=>{this.classificationService.refreshIndex()})),this.registerEvent(this.app.vault.on("rename",()=>{this.classificationService.refreshIndex()})),console.log("[CDC] Cross-Domain Connector plugin loaded")}async onunload(){console.log("[CDC] Unloading Cross-Domain Connector plugin"),se()}async loadSettings(){let e=await this.loadData();this.settings=ce(e||{})}async saveSettings(){await this.saveData(this.settings),this.settings.ai.apiKeys[this.settings.ai.provider]?(this.aiService?pe(this.settings.ai):(this.aiService=ne(this.settings.ai),this.analogyUseCase=new O(this.aiService)),this.deepSerendipityUseCase=new B(this.embeddingsReader,this.classificationService,this.aiService,{maxPairsToEvaluate:this.settings.discovery.deepMaxPairs,minQualityScore:this.settings.discovery.deepMinQuality,maxResults:this.settings.discovery.maxResults,includeFolders:this.settings.discovery.includeFolders,excludeFolders:this.settings.discovery.excludeFolders})):(this.aiService=null,this.analogyUseCase=null,this.deepSerendipityUseCase=null,se()),this.classificationService=new F(this.app.vault,e=>this.app.metadataCache.getFileCache(e),{method:this.settings.advanced.classificationMethod,domainTagPrefixes:this.settings.advanced.domainTagPrefixes}),this.discoverUseCase=new $(this.app.vault,this.embeddingsReader,this.classificationService,{minSimilarity:this.settings.discovery.minSimilarity,minSerendipityScore:this.settings.discovery.minSerendipityScore,maxResults:this.settings.discovery.maxResults,excludeFolders:this.settings.discovery.excludeFolders,includeFolders:this.settings.discovery.includeFolders,linkChecker:this.createLinkChecker()})}async resetSettings(){this.settings={...E},await this.saveSettings()}async getEmbeddingCount(){return this.embeddingsReader.getEmbeddingCount()}getLinkCreationService(){return this.linkCreationService}createLinkChecker(){return(e,i)=>{let n=(0,h.normalizePath)(e),s=(0,h.normalizePath)(i),r=this.app.vault.getAbstractFileByPath(n),o=this.app.vault.getAbstractFileByPath(s);if(!(r instanceof h.TFile)||!(o instanceof h.TFile)){let d=this.app.vault.getMarkdownFiles();r instanceof h.TFile||(r=d.find(m=>m.path===n)||null),o instanceof h.TFile||(o=d.find(m=>m.path===s)||null)}if(!(r instanceof h.TFile)||!(o instanceof h.TFile))return!1;let a=this.app.metadataCache.getFileCache(r);if(a!=null&&a.links)for(let d of a.links){let m=this.app.metadataCache.getFirstLinkpathDest(d.link,r.path);if(m&&m.path===o.path)return!0}let l=this.app.metadataCache.getFileCache(o);if(l!=null&&l.links)for(let d of l.links){let m=this.app.metadataCache.getFirstLinkpathDest(d.link,o.path);if(m&&m.path===r.path)return!0}return!1}}async getSerendipityCache(){let e=await this.loadData();return e!=null&&e.serendipityCache?ae(e.serendipityCache):null}async setSerendipityCache(e){let i=await this.loadData()||{};i.serendipityCache=e,await this.saveData(i)}async clearSerendipityCache(){let e=await this.loadData()||{};delete e.serendipityCache,await this.saveData(e)}getDeepSerendipityUseCase(){return this.deepSerendipityUseCase}async getDeepSerendipityCache(){let e=await this.loadData();return e!=null&&e.deepSerendipityCache?e.deepSerendipityCache:null}async setDeepSerendipityCache(e){let i=await this.loadData()||{};i.deepSerendipityCache=e,await this.saveData(i)}async clearDeepSerendipityCache(){let e=await this.loadData()||{};delete e.deepSerendipityCache,await this.saveData(e)}async activateView(){let{workspace:e}=this.app,i=e.getLeavesOfType(T)[0];if(!i){let n=e.getRightLeaf(!1);n&&(i=n,await i.setViewState({type:T,active:!0}))}i&&e.revealLeaf(i)}};
